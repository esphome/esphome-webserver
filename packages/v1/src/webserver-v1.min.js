const source=new EventSource("/events");source.addEventListener("log",(function(o){const t=document.getElementById("log");let n=[["[1;31m","e"],["[0;33m","w"],["[0;32m","i"],["[0;35m","c"],["[0;36m","d"],["[0;37m","v"]],e="",s="";for(const t of n)o.data.startsWith(t[0])&&(e=t[1],s=t[0]);if(""==e)return void(t.innerHTML+=o.data+"\n");const c=o.data.substr(7,o.data.length-11).split("\n");let i="";const r=c[0].match(/^(.*?\]:)/);r&&(i=r[1]),c.forEach(((o,n)=>{o&&(t.innerHTML+=0===n?'<span class="'+e+'">'+o+"</span>\n":'<span class="'+e+'">'+i+o+"</span>\n")}))})),actions=[["switch",["toggle"]],["light",["toggle"]],["fan",["toggle"]],["cover",["open","close"]],["button",["press"]],["lock",["lock","unlock","open"]]],multi_actions=[["select","option"],["number","value"]],source.addEventListener("state",(function(o){const t=JSON.parse(o.data);document.getElementById(t.id).children[1].innerText=t.state}));const states=document.getElementById("states");let row,i=0;for(;row=states.rows[i];i++)if(row.children[2].children.length){for(const o of actions)if(row.classList.contains(o[0])){let t=row.id.substr(o[0].length+1);for(let n=0;n<row.children[2].children.length&&n<o[1].length;n++)row.children[2].children[n].addEventListener("click",(function(){const e=new XMLHttpRequest;e.open("POST","/"+o[0]+"/"+t+"/"+o[1][n],!0),e.send()}))}for(const o of multi_actions)if(row.classList.contains(o[0])){let t=row.id.substr(o[0].length+1);row.children[2].children[0].addEventListener("change",(function(){const n=new XMLHttpRequest;n.open("POST","/"+o[0]+"/"+t+"/set?"+o[1]+"="+encodeURIComponent(this.value),!0),n.send()}))}}