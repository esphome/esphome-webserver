<script>
(() => {
  window.s = new EventSource('/events');
  // window.s = new EventSource('http://192.168.0.56/events');

  let entities = [];
  let config = {};

  window.s?.addEventListener("ping", (e) => {
    // data: {"title":"garazs-temp","comment":"Garage Temp and Light Module","ota":true,"log":true,"lang":"en"}

    if (e.data) {
      const data = JSON.parse(e.data);
      config = data;

      let div = document.createElement("tr");
      div.innerHTML = `<th colspan=2>${data.title} - ${data.comment}</th>`;
      const main = document.getElementById("m");
      main.insertBefore(div, main.firstChild);
    }
  });

  window.s?.addEventListener("state", (e) => {
    try {
      const data = JSON.parse(e.data);
      let idx = entities.findIndex((x) => x.id === data.id);
      if (idx === -1 && data.id) {
        //let parts = data.id.split("-");
        entities.push(data);
        //entities.sort((a, b) => (a.name < b.name ? -1 : 1));

        let tr1 = document.createElement("tr");
        tr1.id = data.id;
        tr1.innerHTML = `<td>${data.name}</td><td>${data.state??''}</td>`;
        const main = document.getElementById("m");
        main.append(tr1);
      } else {
        document.querySelector(`#${data.id} td:last-child`).innerHTML = data?.state;
      }
    } catch (e) {
      console.dir(e);
    }
  });
})();
</script>

<style>html,td{font-family:Calibri} n{font-size:smaller;color:lightgray} td:first-child{padding-right:2em}</style>
<table id="m">
</table>
